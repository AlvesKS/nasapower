<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Use Case: Using nasapower and the APSIM R Package to Create APSIM .met Files • nasapower</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Use Case: Using nasapower and the APSIM R Package to Create APSIM .met Files" />

<meta property="og:description" content="" />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-article">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nasapower</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nasapower.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/use-case.html">Use Case: Using nasapower and the APSIM R Package to Create APSIM .met Files</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/adamhsparks/nasapower">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>


<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Use Case: Using nasapower and the APSIM R Package to Create APSIM .met Files</h1>
                        <h4 class="author">Adam H. Sparks</h4>
            
      
      <small class="dont-index">Source: <a href='https://github.com/adamhsparks/nasapower/blob/master/vignettes/use-case.Rmd'><code>vignettes/use-case.Rmd</code></a></small>
      <div class="hidden name"><code>use-case.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>NASA - POWER data are often used with APSIM (White <em>et al.</em> 2012) or other models where data may be missing or as a whole data set where data are not readily available, <em>e.g.</em> modelling rice disease globally (Savary <em>et al.</em> 2012).</p>
<p>In this use case we illustrate how use NASA-POWER radiation data with existing station data that lacks radiation and format for use in the APSIM model (Keating et al. 2003) by creating a .met file using the R package, <em>APSIM</em> (Fainges 2017).</p>
</div>
<div id="install-and-load-packages" class="section level1">
<h1>Install and Load Packages</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;APSIM&quot;</span>)</a></code></pre></div>
<p>Load the packages necessary.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(APSIM)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(nasapower)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
</div>
<div id="download-nasa-power-solar-radiation-data" class="section level1">
<h1>Download NASA-POWER Solar Radiation Data</h1>
<p>Using the <code>APSIM::prepareMet()</code> example, where data for Kingsthorpe, Qld, is provided by the package, we can create an equivalent data set from the NASA-POWER data compare it with the supplied data for Kingsthorpe, Queensland location 151.81 degrees longitude and -27.48 degrees latitude, for 2010. As a proxy for potential incoming radiation, <code>SRAD</code>, we’ll use <code>ALLSKY_SFC_SW_DWN</code>, insolation incident on a horizontal surface, from NASA - POWER.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">sw_dwn &lt;-<span class="st"> </span><span class="kw">get_power</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">lonlat =</span> <span class="kw">c</span>(<span class="fl">151.81</span>, <span class="fl">-27.48</span>),</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">dates =</span> <span class="kw">c</span>(<span class="st">&quot;2010-01-01&quot;</span>, <span class="st">&quot;2010-12-31&quot;</span>),</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">pars =</span> <span class="st">&quot;ALLSKY_SFC_SW_DWN&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dt">community =</span> <span class="st">&quot;AG&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="dt">temporal_average =</span> <span class="st">&quot;DAILY&quot;</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  )</a></code></pre></div>
<pre><code>Fetching single point data for lat -27.48, lon 151.81</code></pre>
</div>
<div id="compare-the-data" class="section level1">
<h1>Compare the Data</h1>
<p>To compare the data more easily using a graph and correlation measures, join the two data frames to create a data frame called, <code>compare</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">compare &lt;-<span class="st"> </span><span class="kw">data.frame</span>(kingsData<span class="op">$</span>rad, sw_dwn<span class="op">$</span>ALLSKY_SFC_SW_DWN)</a></code></pre></div>
<p>Graph radiation values from the weather station at Kingsthorpe in <code>APSIM::kingsData</code> along against the POWER data to illustrate why POWER data are often used as a substitute for on-the-ground measurements.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ggplot</span>(compare, <span class="kw">aes</span>(<span class="dt">x =</span> kingsData.rad, <span class="dt">y =</span> sw_dwn.ALLSKY_SFC_SW_DWN)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;#3b6baf&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<div class="figure">
<img src="../man/figures/use-case_Figure1.png" alt="Comparison of NASA-POWER data with kingsData from APSIM" />
<p class="caption">Comparison of NASA-POWER data with kingsData from APSIM</p>
</div>
<p>Check the correlation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">cor</span>(compare<span class="op">$</span>kingsData.rad, compare<span class="op">$</span>sw_dwn.ALLSKY_SFC_SW_DWN)</a></code></pre></div>
<pre><code>[1] 0.9033127</code></pre>
</div>
<div id="create-a-.met-file" class="section level1">
<h1>Create a .met File</h1>
<p>Now that we have the data from NASA-POWER, it’s possible to create a .met file for use in APSIM using the <em>APSIM</em> package if the data are missing the solar radiation. A duplicate data set of the <code>kingsData</code> from <em>APSIM</em> has been created, which has <code>rad</code> missing, <code>kings_nasa</code>. Using that data set, merge with the <code>swv_dwn</code> from the POWER data and create an APSIM .met file.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">kings_nasa &lt;-<span class="st"> </span>kingsData[, <span class="dv">-6</span>]</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co"># inspect the kings_nasa data</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">str</span>(kings_nasa)</a></code></pre></div>
<pre><code>&#39;data.frame&#39;:   365 obs. of  9 variables:
 $ Date       : chr  &quot;1/01/2010&quot; &quot;2/01/2010&quot; &quot;3/01/2010&quot; &quot;4/01/2010&quot; ...
 $ max.temp   : num  28.5 31.2 33.6 27.1 27.8 ...
 $ min.temp   : num  19.5 20.5 22.3 21.2 18.4 ...
 $ rain       : num  0.2 0.6 0 3.4 0 0 0 7.4 0.2 0 ...
 $ evaporation: num  2.6 4.4 5.8 4.6 3.6 ...
 $ vp         : num  18.1 22.1 24.3 21.5 19.2 ...
 $ Windrun.km : int  NA NA NA NA NA NA NA NA 357 248 ...
 $ RH.at.9am  : num  NA NA NA NA NA ...
 $ SVP.at.9am : num  NA NA NA NA NA ...</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># join the kings_data with swv_dwn from POWER</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">kings_met &lt;-<span class="st"> </span><span class="kw">data.frame</span>(kings_nasa, sw_dwn<span class="op">$</span>ALLSKY_SFC_SW_DWN)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># rearrange the columns to match expected order for .met file</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">kings_met &lt;-<span class="st"> </span>kings_met[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">9</span>)]</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># from the APSIM documentation example</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">new_names &lt;-</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>,</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">    <span class="st">&quot;maxt&quot;</span>,</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">    <span class="st">&quot;mint&quot;</span>,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">    <span class="st">&quot;rain&quot;</span>,</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">    <span class="st">&quot;evaporation&quot;</span>,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">    <span class="st">&quot;radn&quot;</span>,</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">    <span class="st">&quot;vp&quot;</span>,</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">    <span class="st">&quot;Wind&quot;</span>,</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">    <span class="st">&quot;RH&quot;</span>,</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">    <span class="st">&quot;SVP&quot;</span>)</a>
<a class="sourceLine" id="cb12-19" data-line-number="19"></a>
<a class="sourceLine" id="cb12-20" data-line-number="20">units &lt;-</a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;()&quot;</span>,</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">    <span class="st">&quot;(oC)&quot;</span>,</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">    <span class="st">&quot;(oC)&quot;</span>,</a>
<a class="sourceLine" id="cb12-24" data-line-number="24">    <span class="st">&quot;(mm)&quot;</span>,</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">    <span class="st">&quot;(mm)&quot;</span>,</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">    <span class="st">&quot;(MJ/m^2/day)&quot;</span>,</a>
<a class="sourceLine" id="cb12-27" data-line-number="27">    <span class="st">&quot;()&quot;</span>,</a>
<a class="sourceLine" id="cb12-28" data-line-number="28">    <span class="st">&quot;()&quot;</span>,</a>
<a class="sourceLine" id="cb12-29" data-line-number="29">    <span class="st">&quot;()&quot;</span>,</a>
<a class="sourceLine" id="cb12-30" data-line-number="30">    <span class="st">&quot;()&quot;</span>)</a></code></pre></div>
<p>Using the <code>kings_met</code> data frame created previously, along with the <code>new_names</code> and <code>units</code> data frames, use <code>APSIM::prepareMet()</code> to create a .met file.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">nasa_met &lt;-<span class="st"> </span><span class="kw">prepareMet</span>(kings_met,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">           <span class="dt">lat =</span> <span class="fl">-27.48</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">           <span class="dt">lon =</span> <span class="fl">151.81</span>,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">           <span class="dt">newNames =</span> new_names,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">           <span class="dt">units =</span> units)</a></code></pre></div>
<pre><code>[1] &quot;Required column name check:&quot;
[1] &quot;maxt&quot; &quot;mint&quot; &quot;radn&quot; &quot;rain&quot; &quot;year&quot; &quot;day&quot; 
[1] TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
<p>Inspect the new object.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">str</span>(nasa_met)</a></code></pre></div>
<pre><code>Formal class &#39;metFile&#39; [package &quot;APSIM&quot;] with 7 slots
  ..@ const: chr(0) 
  ..@ lat  : num -27.5
  ..@ lon  : num 152
  ..@ tav  : num 14.3
  ..@ amp  : num 18.4
  ..@ units: chr [1:12] &quot;()&quot; &quot;(oC)&quot; &quot;(oC)&quot; &quot;(mm)&quot; ...
  ..@ data :&#39;data.frame&#39;:   365 obs. of  12 variables:
  .. ..$ date       : chr [1:365] &quot;1/1/2010&quot; &quot;2/1/2010&quot; &quot;3/1/2010&quot; &quot;4/1/2010&quot; ...
  .. ..$ maxt       : num [1:365] 28.5 31.2 33.6 27.1 27.8 ...
  .. ..$ mint       : num [1:365] 19.5 20.5 22.3 21.2 18.4 ...
  .. ..$ rain       : num [1:365] 0.2 0.6 0 3.4 0 0 0 7.4 0.2 0 ...
  .. ..$ evaporation: num [1:365] 2.6 4.4 5.8 4.6 3.6 ...
  .. ..$ radn       : num [1:365] 13 17.8 21.8 16.9 17.8 ...
  .. ..$ vp         : num [1:365] 18.1 22.1 24.3 21.5 19.2 ...
  .. ..$ Wind       : int [1:365] NA NA NA NA NA NA NA NA 357 248 ...
  .. ..$ RH         : num [1:365] NA NA NA NA NA ...
  .. ..$ SVP        : num [1:365] NA NA NA NA NA ...
  .. ..$ year       : num [1:365] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
  .. ..$ day        : num [1:365] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p>You now have a complete .met file for use in APSIM that supplies solar radiation from the NASA-POWER data. It can be saved to local disk if desired using <code>APSIM::writeMetFile()</code> from <em>APSIM</em>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">writeMetFile</span>(<span class="st">&quot;NASA_rad.met&quot;</span>, nasa_met)</a></code></pre></div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Justin Fainges (2017) “APSIM: General Utility Functions for the ‘Agricultural Production Systems Simulator’”. R package version 0.9.2. <a href="https://CRAN.R-project.org/package=APSIM" class="uri">https://CRAN.R-project.org/package=APSIM</a></p>
<p>Keating, Brian A., Peter S. Carberry, Graeme L. Hammer, Mervyn E. Probert, Michael J. Robertson, D. Holzworth, Neil I. Huth et al. “An overview of APSIM, a model designed for farming systems simulation.” European Journal of Agronomy 18, no. 3 (2003): 267-288.</p>
<p>Serge Savary, Andrew Nelson, Laetitia Willocquet, Ireneo Pangga and Jorrel Aunario (2012) “Modeling and Mapping potential epidemics of rice diseases globally” Crop Protection, Volume 34, Pages 6-17, ISSN 0261-2194 DOI: 10.1016/j.cropro.2011.11.009</p>
<p>Jeffrey W. White, Gerrit Hoogenboom, Paul W. Stackhouse, James M. Hoell (2009) “Evaluation of NASA satellite- and assimilation model-derived long-term daily temperature data over the continental US” Agricultural and Forest Meteorology, Volume 148, Issue 10, 2008, Pages 1574-1584, ISSN 0168-1923, DOI: 10.1016/j.agrformet.2008.05.017.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#install-and-load-packages">Install and Load Packages</a></li>
      <li><a href="#download-nasa-power-solar-radiation-data">Download NASA-POWER Solar Radiation Data</a></li>
      <li><a href="#compare-the-data">Compare the Data</a></li>
      <li><a href="#create-a-.met-file">Create a .met File</a></li>
      <li><a href="#references">References</a></li>
      </ul>
    </div>
      </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Adam H. Sparks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>
